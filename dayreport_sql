SELECT u.userid, u.name, IF( COUNT( c.checktime ) >0, MIN( c.checktime ) , "Nihil" ) AS Datang, IF( COUNT( c.checktime ) >1, MAX( c.checktime ) , "Nihil" ) AS Pulang
FROM userinfo u
LEFT JOIN checkinout c ON u.userid = c.userid
AND DATE( c.checktime ) = '2016-7-15'
WHERE u.defaultdeptid =2
GROUP BY u.userid, DATE( c.checktime )
ORDER BY u.userid ASC

SELECT u.userid, u.name, IF( COUNT( c.checktime ) >0, MIN( c.checktime ) , "Nihil" ) AS Datang, IF( COUNT( c.checktime ) >1, MAX( c.checktime ) , "Nihil" ) AS Pulang,
k.statusid
FROM userinfo u
LEFT JOIN checkinout c ON u.userid = c.userid
LEFT JOIN keterangan_absen k ON u.userid = k.userid AND DATE(c.checktime) BETWEEN k.tgl_awal AND k.tgl_akhir
AND DATE( c.checktime ) = '2016-7-15'
WHERE u.defaultdeptid =2
GROUP BY u.userid, DATE( c.checktime )
ORDER BY u.userid ASC

SELECT userid, statusid, SUM(DATEDIFF(IF(tgl_akhir IS NULL,tgl_awal,tgl_akhir), tgl_awal)+1) Jumlah
FROM keterangan_absen
GROUP BY userid, statusid
ORDER BY userid


SELECT userid, 
SUM(IF(statusid='S', DATEDIFF(IF(tgl_akhir IS NULL, tgl_awal, tgl_akhir), tgl_awal)+1, 0 )) AS Sakit,
SUM(IF(statusid='I', DATEDIFF(IF(tgl_akhir IS NULL, tgl_awal, tgl_akhir), tgl_awal)+1, 0 )) AS Ijin,
SUM(IF(statusid='TD', DATEDIFF(IF(tgl_akhir IS NULL, tgl_awal, tgl_akhir), tgl_awal)+1, 0 )) AS Tugas_Dinas
FROM keterangan_absen
GROUP BY userid
ORDER BY userid
